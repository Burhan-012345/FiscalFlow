{% extends "base.html" %}

{% block title %}Settings - FiscalFlow{% endblock %}

{% block extra_css %}
<style>
    .settings-nav .nav-link {
        border: none;
        border-radius: 8px;
        margin-bottom: 5px;
        padding: 12px 16px;
        color: #495057;
        transition: all 0.2s ease;
    }
    
    .settings-nav .nav-link:hover {
        background-color: #e3f2fd;
        color: #1565c0;
    }
    
    .settings-nav .nav-link.active {
        background-color: #1565c0;
        color: white;
        font-weight: 600;
    }
    
    .settings-section {
        display: none;
    }
    
    .settings-section.active {
        display: block;
    }
    
    .integration-card {
        border: 1px solid #e9ecef;
        border-radius: 8px;
        padding: 1.5rem;
        margin-bottom: 1rem;
        transition: all 0.2s ease;
    }
    
    .integration-card:hover {
        border-color: #1565c0;
        box-shadow: 0 2px 8px rgba(21, 101, 192, 0.1);
    }
    
    .integration-card.disabled {
        opacity: 0.6;
        background-color: #f8f9fa;
    }
    
    .api-key {
        font-family: 'Courier New', monospace;
        background: #f8f9fa;
        padding: 8px 12px;
        border-radius: 4px;
        border: 1px solid #dee2e6;
    }
    
    .danger-zone {
        border: 2px solid #dc3545;
        border-radius: 8px;
        padding: 1.5rem;
        background: #f8f9fa;
    }
    
    .backup-item {
        border-left: 3px solid #28a745;
        padding-left: 1rem;
        margin-bottom: 1rem;
    }
    
    .theme-option {
        border: 2px solid #e9ecef;
        border-radius: 8px;
        padding: 1rem;
        text-align: center;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .theme-option:hover {
        border-color: #1565c0;
    }
    
    .theme-option.active {
        border-color: #1565c0;
        background-color: #e3f2fd;
    }
    
    .theme-preview {
        width: 60px;
        height: 40px;
        border-radius: 4px;
        margin: 0 auto 10px;
        border: 1px solid #dee2e6;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col">
            <h1 class="h2 fw-bold">
                <i class="fas fa-cog me-2"></i>Settings
            </h1>
            <p class="text-muted mb-0">Manage your FiscalFlow application settings and preferences</p>
        </div>
    </div>

    <div class="row">
        <!-- Settings Navigation -->
        <div class="col-lg-3">
            <div class="card">
                <div class="card-body p-0">
                    <nav class="settings-nav">
                        <div class="nav flex-column p-3">
                            <a class="nav-link active" href="#" data-section="general">
                                <i class="fas fa-sliders-h me-2"></i>General
                            </a>
                            <a class="nav-link" href="#" data-section="appearance">
                                <i class="fas fa-palette me-2"></i>Appearance
                            </a>
                            <a class="nav-link" href="#" data-section="notifications">
                                <i class="fas fa-bell me-2"></i>Notifications
                            </a>
                            <a class="nav-link" href="#" data-section="integrations">
                                <i class="fas fa-plug me-2"></i>Integrations
                            </a>
                            <a class="nav-link" href="#" data-section="backup">
                                <i class="fas fa-database me-2"></i>Backup & Restore
                            </a>
                            <a class="nav-link" href="#" data-section="api">
                                <i class="fas fa-code me-2"></i>API
                            </a>
                            <a class="nav-link" href="#" data-section="danger">
                                <i class="fas fa-exclamation-triangle me-2"></i>Danger Zone
                            </a>
                        </div>
                    </nav>
                </div>
            </div>
        </div>

        <!-- Settings Content -->
        <div class="col-lg-9">
            <!-- General Settings -->
            <div class="settings-section active" id="general-section">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-sliders-h me-2"></i>General Settings
                        </h5>
                    </div>
                    <div class="card-body">
                        <form method="POST" action="{{ url_for('update_general_settings') }}">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="defaultCurrency" class="form-label">Default Currency</label>
                                    <select class="form-select" id="defaultCurrency" name="default_currency">
                                        <option value="INR" {{ 'selected' if settings.default_currency == 'INR' }}>Indian Rupee (₹)</option>
                                        <option value="USD" {{ 'selected' if settings.default_currency == 'USD' }}>US Dollar ($)</option>
                                        <option value="EUR" {{ 'selected' if settings.default_currency == 'EUR' }}>Euro (€)</option>
                                        <option value="GBP" {{ 'selected' if settings.default_currency == 'GBP' }}>British Pound (£)</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label for="dateFormat" class="form-label">Date Format</label>
                                    <select class="form-select" id="dateFormat" name="date_format">
                                        <option value="YYYY-MM-DD" {{ 'selected' if settings.date_format == 'YYYY-MM-DD' }}>YYYY-MM-DD</option>
                                        <option value="DD/MM/YYYY" {{ 'selected' if settings.date_format == 'DD/MM/YYYY' }}>DD/MM/YYYY</option>
                                        <option value="MM/DD/YYYY" {{ 'selected' if settings.date_format == 'MM/DD/YYYY' }}>MM/DD/YYYY</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="timezone" class="form-label">Timezone</label>
                                    <select class="form-select" id="timezone" name="timezone">
                                        <option value="Asia/Kolkata" {{ 'selected' if settings.timezone == 'Asia/Kolkata' }}>India Standard Time (IST)</option>
                                        <option value="UTC" {{ 'selected' if settings.timezone == 'UTC' }}>Coordinated Universal Time (UTC)</option>
                                        <option value="America/New_York" {{ 'selected' if settings.timezone == 'America/New_York' }}>Eastern Time (ET)</option>
                                        <option value="Europe/London" {{ 'selected' if settings.timezone == 'Europe/London' }}>British Summer Time (BST)</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label for="itemsPerPage" class="form-label">Items Per Page</label>
                                    <select class="form-select" id="itemsPerPage" name="items_per_page">
                                        <option value="10" {{ 'selected' if settings.items_per_page == 10 }}>10 items</option>
                                        <option value="25" {{ 'selected' if settings.items_per_page == 25 }}>25 items</option>
                                        <option value="50" {{ 'selected' if settings.items_per_page == 50 }}>50 items</option>
                                        <option value="100" {{ 'selected' if settings.items_per_page == 100 }}>100 items</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="autoLogout" name="auto_logout" 
                                           {{ 'checked' if settings.auto_logout else '' }}>
                                    <label class="form-check-label" for="autoLogout">
                                        Enable Auto Logout
                                        <small class="text-muted d-block">Automatically log out after 60 minutes of inactivity</small>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="emailReports" name="email_reports" 
                                           {{ 'checked' if settings.email_reports else '' }}>
                                    <label class="form-check-label" for="emailReports">
                                        Email Weekly Reports
                                        <small class="text-muted d-block">Send weekly summary reports to your email</small>
                                    </label>
                                </div>
                            </div>
                            
                            <button type="submit" class="btn btn-primary">Save General Settings</button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Appearance Settings -->
            <div class="settings-section" id="appearance-section">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-palette me-2"></i>Appearance
                        </h5>
                    </div>
                    <div class="card-body">
                        <form method="POST" action="{{ url_for('update_appearance_settings') }}">
                            <div class="mb-4">
                                <h6 class="mb-3">Theme</h6>
                                <div class="row">
                                    <div class="col-md-3 mb-3">
                                        <div class="theme-option {{ 'active' if settings.theme == 'light' else '' }}" data-theme="light">
                                            <div class="theme-preview" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"></div>
                                            <span>Light</span>
                                        </div>
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <div class="theme-option {{ 'active' if settings.theme == 'dark' else '' }}" data-theme="dark">
                                            <div class="theme-preview" style="background: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);"></div>
                                            <span>Dark</span>
                                        </div>
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <div class="theme-option {{ 'active' if settings.theme == 'auto' else '' }}" data-theme="auto">
                                            <div class="theme-preview" style="background: linear-gradient(135deg, #667eea 0%, #2d3748 100%);"></div>
                                            <span>Auto</span>
                                        </div>
                                    </div>
                                </div>
                                <input type="hidden" name="theme" id="selectedTheme" value="{{ settings.theme or 'light' }}">
                            </div>
                            
                            <div class="mb-4">
                                <h6 class="mb-3">Dashboard Layout</h6>
                                <select class="form-select" name="dashboard_layout">
                                    <option value="compact" {{ 'selected' if settings.dashboard_layout == 'compact' }}>Compact</option>
                                    <option value="spacious" {{ 'selected' if settings.dashboard_layout == 'spacious' }}>Spacious</option>
                                    <option value="grid" {{ 'selected' if settings.dashboard_layout == 'grid' }}>Grid</option>
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="animations" name="animations" 
                                           {{ 'checked' if settings.animations else '' }}>
                                    <label class="form-check-label" for="animations">
                                        Enable Animations
                                        <small class="text-muted d-block">Page transitions and hover effects</small>
                                    </label>
                                </div>
                            </div>
                            
                            <button type="submit" class="btn btn-primary">Save Appearance Settings</button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Notification Settings -->
            <div class="settings-section" id="notifications-section">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-bell me-2"></i>Notification Settings
                        </h5>
                    </div>
                    <div class="card-body">
                        <form method="POST" action="{{ url_for('update_notification_settings') }}">
                            <h6 class="mb-3">Email Notifications</h6>
                            <div class="mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="transactionEmails" name="transaction_emails" 
                                           {{ 'checked' if settings.transaction_emails else '' }}>
                                    <label class="form-check-label" for="transactionEmails">
                                        Transaction Updates
                                        <small class="text-muted d-block">Get notified for new transactions</small>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="balanceAlerts" name="balance_alerts" 
                                           {{ 'checked' if settings.balance_alerts else '' }}>
                                    <label class="form-check-label" for="balanceAlerts">
                                        Balance Alerts
                                        <small class="text-muted d-block">Notifications for significant balance changes</small>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="reportReady" name="report_ready" 
                                           {{ 'checked' if settings.report_ready else '' }}>
                                    <label class="form-check-label" for="reportReady">
                                        Report Ready
                                        <small class="text-muted d-block">When generated reports are available</small>
                                    </label>
                                </div>
                            </div>
                            
                            <h6 class="mb-3 mt-4">Push Notifications</h6>
                            <div class="mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="browserNotifications" name="browser_notifications" 
                                           {{ 'checked' if settings.browser_notifications else '' }}>
                                    <label class="form-check-label" for="browserNotifications">
                                        Browser Notifications
                                        <small class="text-muted d-block">Show desktop notifications</small>
                                    </label>
                                </div>
                            </div>
                            
                            <button type="submit" class="btn btn-primary">Save Notification Settings</button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Integrations -->
            <div class="settings-section" id="integrations-section">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-plug me-2"></i>Integrations
                        </h5>
                    </div>
                    <div class="card-body">
                        <!-- Google Sheets Integration -->
                        <div class="integration-card {{ 'disabled' if not integrations.google_sheets }}">
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <div>
                                    <h6 class="mb-1">
                                        <i class="fab fa-google me-2"></i>Google Sheets
                                    </h6>
                                    <p class="text-muted mb-0">Sync your transaction data with Google Sheets</p>
                                </div>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" 
                                           {{ 'checked' if integrations.google_sheets else '' }}>
                                </div>
                            </div>
                            {% if integrations.google_sheets %}
                            <div class="alert alert-success">
                                <i class="fas fa-check-circle me-2"></i>
                                Connected to Google Sheets
                            </div>
                            <button class="btn btn-outline-danger btn-sm">Disconnect</button>
                            {% else %}
                            <button class="btn btn-outline-primary btn-sm">Connect</button>
                            {% endif %}
                        </div>

                        <!-- Slack Integration -->
                        <div class="integration-card {{ 'disabled' if not integrations.slack }}">
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <div>
                                    <h6 class="mb-1">
                                        <i class="fab fa-slack me-2"></i>Slack
                                    </h6>
                                    <p class="text-muted mb-0">Get transaction alerts in your Slack workspace</p>
                                </div>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" 
                                           {{ 'checked' if integrations.slack else '' }}>
                                </div>
                            </div>
                            {% if integrations.slack %}
                            <div class="alert alert-success">
                                <i class="fas fa-check-circle me-2"></i>
                                Connected to Slack
                            </div>
                            <button class="btn btn-outline-danger btn-sm">Disconnect</button>
                            {% else %}
                            <button class="btn btn-outline-primary btn-sm">Connect</button>
                            {% endif %}
                        </div>

                        <!-- QuickBooks Integration -->
                        <div class="integration-card {{ 'disabled' if not integrations.quickbooks }}">
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <div>
                                    <h6 class="mb-1">
                                        <i class="fas fa-book me-2"></i>QuickBooks
                                    </h6>
                                    <p class="text-muted mb-0">Sync with QuickBooks Online</p>
                                </div>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" 
                                           {{ 'checked' if integrations.quickbooks else '' }}>
                                </div>
                            </div>
                            {% if integrations.quickbooks %}
                            <div class="alert alert-success">
                                <i class="fas fa-check-circle me-2"></i>
                                Connected to QuickBooks
                            </div>
                            <button class="btn btn-outline-danger btn-sm">Disconnect</button>
                            {% else %}
                            <button class="btn btn-outline-primary btn-sm">Connect</button>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Backup & Restore -->
            <div class="settings-section" id="backup-section">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-database me-2"></i>Backup & Restore
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <h6>Create Backup</h6>
                                <p class="text-muted">Download a complete backup of your data</p>
                                <form method="POST" action="{{ url_for('create_backup') }}">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-download me-2"></i>Create Backup
                                    </button>
                                </form>
                            </div>
                            <div class="col-md-6">
                                <h6>Restore Backup</h6>
                                <p class="text-muted">Upload a backup file to restore your data</p>
                                <form method="POST" action="{{ url_for('restore_backup') }}" enctype="multipart/form-data">
                                    <div class="mb-3">
                                        <input type="file" class="form-control" name="backup_file" accept=".json">
                                    </div>
                                    <button type="submit" class="btn btn-warning">
                                        <i class="fas fa-upload me-2"></i>Restore Backup
                                    </button>
                                </form>
                            </div>
                        </div>

                        <h6 class="mb-3">Recent Backups</h6>
                        {% if backups %}
                        {% for backup in backups %}
                        <div class="backup-item">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <strong>{{ backup.filename }}</strong>
                                    <small class="text-muted d-block">{{ backup.created_at.strftime('%Y-%m-%d %H:%M') }}</small>
                                </div>
                                <div>
                                    <a href="{{ url_for('download_backup', backup_id=backup.id) }}" class="btn btn-sm btn-outline-primary me-2">
                                        Download
                                    </a>
                                    <button class="btn btn-sm btn-outline-danger" onclick="deleteBackup('{{ backup.id }}')">
                                        Delete
                                    </button>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                        {% else %}
                        <div class="text-center py-4 text-muted">
                            <i class="fas fa-database fa-2x mb-2"></i>
                            <p>No backups found</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- API Settings -->
            <div class="settings-section" id="api-section">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-code me-2"></i>API Settings
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            Use the FiscalFlow API to integrate with your custom applications and scripts.
                        </div>

                        <div class="mb-4">
                            <h6>API Key</h6>
                            {% if api_key %}
                            <div class="api-key mb-2">{{ api_key }}</div>
                            <small class="text-muted">Keep this key secret. It provides full access to your account.</small>
                            <div class="mt-2">
                                <button class="btn btn-outline-warning btn-sm" onclick="regenerateApiKey()">
                                    Regenerate Key
                                </button>
                                <button class="btn btn-outline-danger btn-sm" onclick="revokeApiKey()">
                                    Revoke Key
                                </button>
                            </div>
                            {% else %}
                            <p class="text-muted">No API key generated yet.</p>
                            <button class="btn btn-primary btn-sm" onclick="generateApiKey()">
                                Generate API Key
                            </button>
                            {% endif %}
                        </div>

                        <div class="mb-3">
                            <h6>API Usage</h6>
                            <div class="row text-center">
                                <div class="col-md-3">
                                    <div class="border rounded p-2">
                                        <h4 class="text-primary mb-0">{{ api_usage.requests_today }}</h4>
                                        <small class="text-muted">Today</small>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="border rounded p-2">
                                        <h4 class="text-success mb-0">{{ api_usage.requests_month }}</h4>
                                        <small class="text-muted">This Month</small>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="border rounded p-2">
                                        <h4 class="text-warning mb-0">{{ api_usage.limit }}</h4>
                                        <small class="text-muted">Daily Limit</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div>
                            <h6>API Documentation</h6>
                            <p class="text-muted">Learn how to use the FiscalFlow API in your applications.</p>
                            <a href="{{ url_for('api_documentation') }}" class="btn btn-outline-primary">
                                <i class="fas fa-book me-2"></i>View Documentation
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Danger Zone -->
            <div class="settings-section" id="danger-section">
                <div class="danger-zone">
                    <h5 class="text-danger mb-4">
                        <i class="fas fa-exclamation-triangle me-2"></i>Danger Zone
                    </h5>

                    <div class="mb-4">
                        <h6>Export All Data</h6>
                        <p class="text-muted">Download all your data in a portable format.</p>
                        <form method="POST" action="{{ url_for('export_all_data') }}">
                            <button type="submit" class="btn btn-outline-primary">
                                <i class="fas fa-file-export me-2"></i>Export All Data
                            </button>
                        </form>
                    </div>

                    <div class="mb-4">
                        <h6>Clear All Data</h6>
                        <p class="text-muted">Permanently delete all your customers, transactions, and settings.</p>
                        <button class="btn btn-outline-warning" data-bs-toggle="modal" data-bs-target="#clearDataModal">
                            <i class="fas fa-trash me-2"></i>Clear All Data
                        </button>
                    </div>

                    <div>
                        <h6>Delete Account</h6>
                        <p class="text-muted">Permanently delete your account and all associated data. This action cannot be undone.</p>
                        <button class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteAccountModal">
                            <i class="fas fa-user-slash me-2"></i>Delete Account
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Clear Data Modal -->
<div class="modal fade" id="clearDataModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title text-warning">
                    <i class="fas fa-exclamation-triangle me-2"></i>Clear All Data
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-circle me-2"></i>
                    <strong>Warning:</strong> This will permanently delete all your data including:
                    <ul class="mt-2 mb-0">
                        <li>All customers and their information</li>
                        <li>All transaction records</li>
                        <li>All reports and generated files</li>
                        <li>All account settings</li>
                    </ul>
                </div>
                <p>This action cannot be undone. Please make sure you have a backup before proceeding.</p>
                <form method="POST" action="{{ url_for('clear_all_data') }}" id="clearDataForm">
                    <div class="mb-3">
                        <label for="confirmClear" class="form-label">
                            Type "DELETE ALL DATA" to confirm:
                        </label>
                        <input type="text" class="form-control" id="confirmClear" name="confirm_text" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" form="clearDataForm" class="btn btn-warning">Clear All Data</button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Account Modal -->
<div class="modal fade" id="deleteAccountModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title text-danger">
                    <i class="fas fa-exclamation-triangle me-2"></i>Delete Account
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-danger">
                    <i class="fas fa-exclamation-circle me-2"></i>
                    <strong>Danger:</strong> This will permanently delete your account and all associated data.
                </div>
                <p>You will lose access to:</p>
                <ul>
                    <li>All customer records</li>
                    <li>All transaction history</li>
                    <li>All generated reports</li>
                    <li>Your account settings and preferences</li>
                </ul>
                <p><strong>This action cannot be undone.</strong></p>
                <form method="POST" action="{{ url_for('delete_account') }}" id="deleteAccountForm">
                    <div class="mb-3">
                        <label for="confirmDelete" class="form-label">
                            Type "DELETE MY ACCOUNT" to confirm:
                        </label>
                        <input type="text" class="form-control" id="confirmDelete" name="confirm_text" required>
                    </div>
                    <div class="mb-3">
                        <label for="deletePassword" class="form-label">Enter your password:</label>
                        <input type="password" class="form-control" id="deletePassword" name="password" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" form="deleteAccountForm" class="btn btn-danger">Delete Account</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Settings navigation
    document.querySelectorAll('.settings-nav .nav-link').forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            
            // Update active nav link
            document.querySelectorAll('.settings-nav .nav-link').forEach(nav => {
                nav.classList.remove('active');
            });
            this.classList.add('active');
            
            // Show corresponding section
            const sectionId = this.getAttribute('data-section');
            document.querySelectorAll('.settings-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(`${sectionId}-section`).classList.add('active');
        });
    });

    // Theme selection
    document.querySelectorAll('.theme-option').forEach(option => {
        option.addEventListener('click', function() {
            document.querySelectorAll('.theme-option').forEach(opt => {
                opt.classList.remove('active');
            });
            this.classList.add('active');
            document.getElementById('selectedTheme').value = this.getAttribute('data-theme');
        });
    });

    // Integration toggles
    document.querySelectorAll('.integration-card .form-check-input').forEach(toggle => {
        toggle.addEventListener('change', function() {
            const card = this.closest('.integration-card');
            if (this.checked) {
                card.classList.remove('disabled');
                // Implement integration enable logic
            } else {
                card.classList.add('disabled');
                // Implement integration disable logic
            }
        });
    });

    function generateApiKey() {
        if (confirm('Are you sure you want to generate a new API key? This will invalidate any existing keys.')) {
            fetch('{{ url_for("generate_api_key") }}', {
                method: 'POST'
            }).then(response => {
                if (response.ok) {
                    location.reload();
                }
            });
        }
    }

    function regenerateApiKey() {
        if (confirm('Are you sure you want to regenerate your API key? This will invalidate the current key.')) {
            fetch('{{ url_for("regenerate_api_key") }}', {
                method: 'POST'
            }).then(response => {
                if (response.ok) {
                    location.reload();
                }
            });
        }
    }

    function revokeApiKey() {
        if (confirm('Are you sure you want to revoke your API key? This will permanently delete it.')) {
            fetch('{{ url_for("revoke_api_key") }}', {
                method: 'POST'
            }).then(response => {
                if (response.ok) {
                    location.reload();
                }
            });
        }
    }

    function deleteBackup(backupId) {
        if (confirm('Are you sure you want to delete this backup?')) {
            fetch(`/backups/${backupId}/delete`, {
                method: 'POST'
            }).then(response => {
                if (response.ok) {
                    location.reload();
                }
            });
        }
    }

    // Form validation for danger zone actions
    document.getElementById('clearDataForm')?.addEventListener('submit', function(e) {
        const confirmText = document.getElementById('confirmClear').value;
        if (confirmText !== 'DELETE ALL DATA') {
            e.preventDefault();
            alert('Please type "DELETE ALL DATA" exactly as shown to confirm.');
        }
    });

    document.getElementById('deleteAccountForm')?.addEventListener('submit', function(e) {
        const confirmText = document.getElementById('confirmDelete').value;
        if (confirmText !== 'DELETE MY ACCOUNT') {
            e.preventDefault();
            alert('Please type "DELETE MY ACCOUNT" exactly as shown to confirm.');
        }
    });
</script>
{% endblock %}